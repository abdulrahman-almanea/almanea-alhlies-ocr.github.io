<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>ูุธุงู ุงูุชุนุฑู ุนูู ุงูุญุฑูู ุงูุนุฑุจูุฉ</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <h1>ูุธุงู ุงูุชุนุฑู ุนูู ุงูุญุฑูู ุงูุนุฑุจูุฉ</h1>
        <p>ูู ุจุฑูุน ุตูุฑุฉ ููุญุฑู ููุชุนุฑู ุนููู</p>
        
        <form id="uploadForm" enctype="multipart/form-data">
            <div class="file-input-container">
                <input type="file" id="fileInput" accept="image/*" required>
                <label for="fileInput" class="file-label">ุงุฎุชุฑ ุตูุฑุฉ</label>
            </div>
            <button type="submit" class="submit-btn">ุชุนุฑู ุนูู ุงูุญุฑู</button>
        </form>
        
        <div id="previewContainer" class="preview-container" style="display: none;">
            <h3>ูุนุงููุฉ ุงูุตูุฑุฉ:</h3>
            <img id="imagePreview" class="preview-image">
        </div>
        
        <div id="results" class="results-container"></div>
        
        <!-- โฌ๏ธ ูุณู ุชุดุบูู ุงูุตูุช ุงููุถุงู -->
        <div id="audioSection" style="display: none; text-align: center; margin-top: 20px;">
            <button id="playSoundBtn" class="play-btn">๐ ุชุดุบูู ูุทู ุงูุญุฑู</button>
            <audio id="letterAudio" preload="none"></audio>
        </div>
        
        <div class="info">
            <h3>ุชุนูููุงุช:</h3>
            <ul>
                <li>ุงุณุชุฎุฏู ุตูุฑ ูุงุถุญุฉ ููุญุฑูู</li>
                <li>ููุถู ุฃู ุชููู ุงูุฎูููุฉ ุจูุถุงุก ูุงูุญุฑู ุฃุณูุฏ</li>
                <li>ุงูุตูุบ ุงููุฏุนููุฉ: PNG, JPG, JPEG</li>
                <li>ููููู ุณูุงุน ูุทู ุงูุญุฑู ุจุนุฏ ุงูุชุนุฑู ุนููู</li>
            </ul>
        </div>
    </div>

    <script>
        const form = document.getElementById("uploadForm");
        const fileInput = document.getElementById("fileInput");
        const resultsDiv = document.getElementById("results");
        const previewContainer = document.getElementById("previewContainer");
        const imagePreview = document.getElementById("imagePreview");
        const audioSection = document.getElementById("audioSection");
        const playSoundBtn = document.getElementById("playSoundBtn");
        const letterAudio = document.getElementById("letterAudio");

        // ูุนุงููุฉ ุงูุตูุฑุฉ
        fileInput.addEventListener("change", function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    imagePreview.src = e.target.result;
                    previewContainer.style.display = 'block';
                }
                reader.readAsDataURL(file);
            }
        });

        // ุฒุฑ ุชุดุบูู ุงูุตูุช
        playSoundBtn.addEventListener("click", function() {
            letterAudio.play().catch(e => {
                console.error("ุฎุทุฃ ูู ุชุดุบูู ุงูุตูุช:", e);
                showResult("โ ุชุนุฐุฑ ุชุดุบูู ุงูุตูุช", "error");
            });
        });

        form.addEventListener("submit", async (e) => {
    e.preventDefault();
    
    const file = fileInput.files[0];
    if (!file) {
        showResult("โ ูุฑุฌู ุงุฎุชูุงุฑ ุตูุฑุฉ ุฃููุงู", "error");
        return;
    }

    const formData = new FormData();
    formData.append("file", file);

    showResult("โณ ุฌุงุฑู ูุนุงูุฌุฉ ุงูุตูุฑุฉ...", "loading");
    audioSection.style.display = 'none';

    try {
        const response = await fetch("http://127.0.0.1:5000/predict", {
            method: "POST",
            body: formData
        });

        const data = await response.json();
        
        if (data.success) {
            showResult(data.message, "success");
            
            // โฌ๏ธ ุงุณุชุฎุฏุงู ุงุณู ุงูููู ูู ุงูุงุณุชุฌุงุจุฉ ุจุฏูุงู ูู ุงูุชุฑุงุถ sound.mp3
            if (data.letter && data.sound_file) {
                const audioPath = `sounds/${data.letter}/${data.sound_file}`;
                letterAudio.src = audioPath;
                
                letterAudio.load();
                letterAudio.oncanplaythrough = () => {
                    audioSection.style.display = 'block';
                    playSoundBtn.textContent = `๐ ุชุดุบูู ูุทู ุงูุญุฑู (${data.letter})`;
                };
                letterAudio.onerror = () => {
                    console.warn("โ๏ธ ูู ูุชู ุงูุนุซูุฑ ุนูู ููู ุงูุตูุช:", audioPath);
                    audioSection.style.display = 'none';
                };
            } else {
                audioSection.style.display = 'none';
                console.warn("โ๏ธ ูุง ููุฌุฏ ููู ุตูุชู ููุญุฑู:", data.letter);
            }
        } else {
            showResult(data.error, "error");
            audioSection.style.display = 'none';
        }
    } catch (error) {
        showResult("โ ุญุฏุซ ุฎุทุฃ ูู ุงูุงุชุตุงู ุจุงูุฎุงุฏู. ุชุฃูุฏ ูู ุชุดุบูู ุงูุณูุฑูุฑ.", "error");
        audioSection.style.display = 'none';
        console.error("ุฎุทุฃ:", error);
    }
});
        function showResult(message, type) {
            resultsDiv.innerHTML = `
                <div class="result ${type}">
                    ${message}
                </div>
            `;
        }
    </script>
</body>
</html>
